

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Feature Engineering Guide &mdash; ballet 0.7.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ballet package" href="api/ballet.html" />
    <link rel="prev" title="Contributor Guide" href="contributor_guide.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> ballet
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="readme.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="readme.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="readme.html#next-steps">Next steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#stable-release">Stable release</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#from-source">From source</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">User Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="maintainer_guide.html">Maintainer Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="maintainer_guide.html#creating-a-ballet-project">Creating a Ballet project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#project-instantiation">Project instantiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#project-installation">Project installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#collaboration-via-git-and-github">Collaboration via git and GitHub</a></li>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#enabling-continuous-integration">Enabling continuous integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#installing-bots">Installing bots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="maintainer_guide.html#developing-new-features">Developing new features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#validating-features">Validating features</a></li>
<li class="toctree-l3"><a class="reference internal" href="maintainer_guide.html#pruning-features">Pruning features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="maintainer_guide.html#applying-the-feature-engineering-pipeline">Applying the feature engineering pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="maintainer_guide.html#updating-the-framework">Updating the framework</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributor_guide.html">Contributor Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributor_guide.html#cloud-feature-development-workflow">Cloud Feature Development Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributor_guide.html#local-feature-development-workflow">Local Feature Development Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="contributor_guide.html#setup-your-development-environment">Setup your development environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributor_guide.html#develop-a-new-feature">Develop a new feature</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="contributor_guide.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Feature Engineering Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#logical-features">Logical Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-features">Writing features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-first-example">A first example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#why">Why?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-types-and-conversions">Input types and conversions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transformers">Transformers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#feature-engineering-pipelines">Feature engineering pipelines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#feature-engineering-primitives">Feature engineering primitives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preprocessing">Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operating-on-groups">Operating on groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#addressing-missing-values">Addressing missing values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operating-on-time-series-data">Operating on time series data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-primitives">Other primitives</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rolling-your-own-transformers">Rolling your own transformers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#further-reading">Further reading</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/ballet.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/ballet.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.eng.html">ballet.eng package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/ballet.eng.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.util.html">ballet.util package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/ballet.util.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.validation.html">ballet.validation package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/ballet.validation.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/ballet.validation.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/ballet.html#submodules">Submodules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.cli.html">ballet.cli module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.client.html">ballet.client module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.compat.html">ballet.compat module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.contrib.html">ballet.contrib module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.exc.html">ballet.exc module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.feature.html">ballet.feature module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.pipeline.html">ballet.pipeline module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.project.html">ballet.project module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.templating.html">ballet.templating module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.transformer.html">ballet.transformer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/ballet.update.html">ballet.update module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html">CLI Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cli_reference.html#ballet-quickstart">quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli_reference.html#ballet-start-new-feature">start-new-feature</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli_reference.html#ballet-update-project-template">update-project-template</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli_reference.html#ballet-validate">validate</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Development Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#types-of-contributions">Types of Contributions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#report-bugs">Report Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#fix-bugs">Fix Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#implement-features">Implement Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#write-documentation">Write Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#submit-feedback">Submit Feedback</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#get-started">Get Started!</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#pull-request-guidelines">Pull Request Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#tips">Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#deploying">Deploying</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Credits</a><ul>
<li class="toctree-l2"><a class="reference internal" href="authors.html#development-lead">Development Lead</a></li>
<li class="toctree-l2"><a class="reference internal" href="authors.html#contributors">Contributors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="history.html#id1">0.7.1 (2020-07-20)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id2">0.7 (2020-07-17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id3">0.6 (2019-11-12)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id4">0.5 (2018-10-14)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id5">0.4 (2018-09-21)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id6">0.3 (2018-04-28)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id7">0.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#id8">0.1</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ballet</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Feature Engineering Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/HDI-Project/ballet/blob/master/docs/feature_engineering_guide.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="feature-engineering-guide">
<h1>Feature Engineering Guide<a class="headerlink" href="#feature-engineering-guide" title="Permalink to this headline">¶</a></h1>
<p>Feature engineering is the process of transforming raw variables into feature values that can be
input to a learning algorithm. In Ballet, feature engineering is centered around creating logical
features.</p>
<p>At the end of the day, a feature is a tuple <code class="docutils literal notranslate"><span class="pre">(input_columns,</span> <span class="pre">transformer_to_apply)</span></code>. Your job
in feature engineering will be to define this tuple of input columns and a transformer to apply
on them.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>By the end of this guide, you will</p>
<ol class="arabic simple">
<li><p>understand the concept of a “logical feature”</p></li>
<li><p>be able to write a simple <code class="docutils literal notranslate"><span class="pre">Feature</span></code> in Ballet</p></li>
<li><p>be familiar with the feature engineering primitives provided in the <code class="docutils literal notranslate"><span class="pre">ballet.eng</span></code> package</p></li>
</ol>
</div>
<div class="section" id="logical-features">
<h2>Logical Features<a class="headerlink" href="#logical-features" title="Permalink to this headline">¶</a></h2>
<p>A logical feature is the semantics and implementation of code to extract feature values from raw
data.</p>
<p>It is a learned map from raw variables in one data instance to feature values,</p>
<div class="math notranslate nohighlight">
\[f: \mathcal{D} \to \mathcal{X} \to \mathbb{R}^{q_f},\]</div>
<p>where <span class="math notranslate nohighlight">\(q_f\)</span> is the dimensionality of the feature values extracted by <span class="math notranslate nohighlight">\(f\)</span>.</p>
<p>A logical feature can produce either a
scalar feature value for each instance (q = 1) or a vector of feature values, as in the case of the
embedding of a categorical variable (q &gt; 1). Each logical feature is parameterized by D indicating
that it learns any information it uses, such as variable means and variances, from D. This
formalizes the separation between training and testing data to avoid any “leakage” of information
during the feature engineering process.</p>
<p>In Ballet, logical features are realized in Python as objects of type <code class="docutils literal notranslate"><span class="pre">ballet.feature.Feature</span></code>.
The input to the feature, in terms of columns of the raw dataset, is specified in the <code class="docutils literal notranslate"><span class="pre">input</span></code>
field. The transformation applied to the raw data is specified in the <code class="docutils literal notranslate"><span class="pre">transformer</span></code> field. The
transformer is an object (or sequence of objects) that provide (or each provide) a fit/tranform
interface.</p>
</div>
<div class="section" id="writing-features">
<h2>Writing features<a class="headerlink" href="#writing-features" title="Permalink to this headline">¶</a></h2>
<p>Let’s dive right into writing features.</p>
<div class="section" id="a-first-example">
<h3>A first example<a class="headerlink" href="#a-first-example" title="Permalink to this headline">¶</a></h3>
<p>Here is a simple feature, for the <a class="reference external" href="https://github.com/HDI-Project/ballet-predict-house-prices">HDI-Project/ballet-predict-house-prices</a> problem. Imagine we are working with
the following simplified dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">X_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span>
   <span class="s1">&#39;Lot Frontage&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">141</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">74</span><span class="p">],</span>
   <span class="s1">&#39;Lot Area&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">31770</span><span class="p">,</span> <span class="mi">11622</span><span class="p">,</span> <span class="mi">14267</span><span class="p">,</span> <span class="mi">11160</span><span class="p">,</span> <span class="mi">13830</span><span class="p">],</span>
   <span class="s1">&#39;Exterior 1st&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;BrkFace&#39;</span><span class="p">,</span> <span class="s1">&#39;VinylSd&#39;</span><span class="p">,</span> <span class="s1">&#39;Wd Sdng&#39;</span><span class="p">,</span> <span class="s1">&#39;BrkFace&#39;</span><span class="p">,</span> <span class="s1">&#39;VinylSd&#39;</span><span class="p">],</span>
<span class="p">})</span>
<span class="n">y_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="mi">215000</span><span class="p">,</span> <span class="mi">105000</span><span class="p">,</span> <span class="mi">172000</span><span class="p">,</span> <span class="mi">244000</span><span class="p">,</span> <span class="mi">189900</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Sale Price&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We define our first feature:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ballet</span> <span class="kn">import</span> <span class="n">Feature</span>
<span class="kn">from</span> <span class="nn">ballet.eng.misc</span> <span class="kn">import</span> <span class="n">IdentityTransformer</span>

<span class="nb">input</span> <span class="o">=</span> <span class="s1">&#39;Lot Area&#39;</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="n">IdentityTransformer</span><span class="p">()</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">transformer</span><span class="o">=</span><span class="n">transformer</span><span class="p">)</span>
</pre></div>
</div>
<p>This feature requests one input, the <code class="docutils literal notranslate"><span class="pre">Lot</span> <span class="pre">Area</span></code> column of the raw dataset. It’s transformer is a
simple identity map. Thus when the feature is executed as part of a pipeline, the transformer’s fit
and transform methods will be called receiving the one column as input.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">as_feature_engineering_pipeline</span><span class="p">()</span>  <span class="c1"># type: ballet.pipeline.FeatureEngineeringPipeline</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_df</span><span class="p">)</span>
<span class="c1"># array([[31770],</span>
<span class="c1">#        [11622],</span>
<span class="c1">#        [14267],</span>
<span class="c1">#        [11160],</span>
<span class="c1">#        [13830]])</span>
</pre></div>
</div>
<p>The semantics are similar to the following imperative code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">X_df</span><span class="p">[</span><span class="nb">input</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="why">
<h3>Why?<a class="headerlink" href="#why" title="Permalink to this headline">¶</a></h3>
<p>In the data science community, it is common to do feature engineering by applying a sequence of
mutations to a data frame object or using <code class="docutils literal notranslate"><span class="pre">sklearn.preprocessing</span></code> objects. Why do we go through
hoops to use <code class="docutils literal notranslate"><span class="pre">Feature</span></code> objects?</p>
<ol class="arabic simple">
<li><p><em>Enforce train/test split.</em> By writing all features as learned transformations (with separate
fit and transform stages), we ensure that feature engineering code never sees test data before
it applies transformations on new instances.</p></li>
<li><p><em>Clearly declare inputs and outputs.</em> Each feature declares its own inputs (and optionally
outputs) and can operate on them only. Thus a feature can impute missing values in a single
column, as opposed to the entire dataset, in the case of the scikit-learn <code class="docutils literal notranslate"><span class="pre">Imputer</span></code> for
example.</p></li>
<li><p><em>Facilitate pipeline idiom.</em> Each feature stands alone but the objects together can be combined
into a pipeline that can learn feature transformations from training data and apply them on
new instances.</p></li>
<li><p><em>Add robustness.</em> Users are often surprised to find the number of errors that arise from trying
to use multiple libraries together, such as pandas and scikit-learn. Common errors include
scikit-learn transformers and estimators failing on columnar data that has the wrong number of
dimensions (i.e. 1-dimensional or 2-dimensional column vectors). Features in Ballet magically
transform feature input data appropriately to avoid common errors.</p></li>
</ol>
</div>
<div class="section" id="input-types-and-conversions">
<h3>Input types and conversions<a class="headerlink" href="#input-types-and-conversions" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">input</span></code> field accepts either a key or a collection of keys (usually strings) identifying
columns from the raw data.</p>
<ul class="simple">
<li><p>if <code class="docutils literal notranslate"><span class="pre">input</span></code> is a scalar key, a 1-dimensional pandas Series or numpy array is passed to the
transformer</p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">input</span></code> is a collection of keys, a 2-dimensional pandas DataFrame or numpy array is
passed to the transformer</p></li>
</ul>
<p>With respect to the discussion about robustness above, ballet tries to pass the most obvious
objects to the transformer. For example, if the raw data is a pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and <code class="docutils literal notranslate"><span class="pre">input</span></code>
is a scalar key, ballet tries to pass a <code class="docutils literal notranslate"><span class="pre">Series</span></code> to the transformer. If that fails in a
predictable way (i.e. the transformer appears to not be able to handle that data type), then ballet
tries again with the next most obvious input data type (a 1-d numpy array), continuous on to a
pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> with one column and finally a 2-d numpy array with one column. The same
principles apply when <code class="docutils literal notranslate"><span class="pre">input</span></code> is a collection of keys, except ballet will not try to pass any 1-d
data.</p>
</div>
<div class="section" id="transformers">
<h3>Transformers<a class="headerlink" href="#transformers" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">transformer</span></code> field accepts either a transformer-like object or a list of transformer-like
objects. By <em>transformer-like</em>, we mean objects that satisfy the scikit-learn Transformer API,
having <code class="docutils literal notranslate"><span class="pre">fit</span></code>, <code class="docutils literal notranslate"><span class="pre">transform</span></code>, and <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code> implementations.</p>
</div>
<div class="section" id="feature-engineering-pipelines">
<h3>Feature engineering pipelines<a class="headerlink" href="#feature-engineering-pipelines" title="Permalink to this headline">¶</a></h3>
<p>A feature engineering pipeline can be created out of a collection of Features. It has a
fit/transform API. When applied to raw data, it applies each underlying feature in parallel,
concatenating the results.</p>
</div>
</div>
<div class="section" id="feature-engineering-primitives">
<h2>Feature engineering primitives<a class="headerlink" href="#feature-engineering-primitives" title="Permalink to this headline">¶</a></h2>
<p>Many features exhibit common patterns, such as scaling or imputing variables using simple
procedures. And while some features are relatively simple and have no learning component, others
are more involved to express. Commonly, data scientists extract these more advanced features by
manipulating training and test tables directly using popular libraries like <em>pandas</em> or <em>dplyr</em>
(often leading to leakage), whereas these operations should instead be rewritten in a fit/transform
style.</p>
<p>To ease this process, Ballet provides a library of feature engineering primitives,
<a class="reference internal" href="api/ballet.eng.html#module-ballet.eng" title="ballet.eng"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ballet.eng</span></code></a>, which implements many common learned transformations and utilities.</p>
<p>Many feature engineering primitives are also available in scikit-learn.</p>
<div class="section" id="preprocessing">
<h3>Preprocessing<a class="headerlink" href="#preprocessing" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.preprocessing">sklearn.preprocessing</a> for a collection of useful preprocessing transformers.</p>
</div>
<div class="section" id="operating-on-groups">
<h3>Operating on groups<a class="headerlink" href="#operating-on-groups" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="api/ballet.eng.base.html#ballet.eng.base.GroupedFunctionTransformer" title="ballet.eng.base.GroupedFunctionTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.base.GroupedFunctionTransformer</span></code></a> and
<a class="reference internal" href="api/ballet.eng.base.html#ballet.eng.base.GroupwiseTransformer" title="ballet.eng.base.GroupwiseTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.base.GroupwiseTransformer</span></code></a>.</p>
</div>
<div class="section" id="addressing-missing-values">
<h3>Addressing missing values<a class="headerlink" href="#addressing-missing-values" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.impute">sklearn.impute</a> and <a class="reference internal" href="api/ballet.eng.missing.html#module-ballet.eng.missing" title="ballet.eng.missing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ballet.eng.missing</span></code></a>.</p>
</div>
<div class="section" id="operating-on-time-series-data">
<h3>Operating on time series data<a class="headerlink" href="#operating-on-time-series-data" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="api/ballet.eng.ts.html#module-ballet.eng.ts" title="ballet.eng.ts"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ballet.eng.ts</span></code></a>.</p>
</div>
<div class="section" id="other-primitives">
<h3>Other primitives<a class="headerlink" href="#other-primitives" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="api/ballet.eng.base.html#ballet.eng.base.SimpleFunctionTransformer" title="ballet.eng.base.SimpleFunctionTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.base.SimpleFunctionTransformer</span></code></a> and
<a class="reference internal" href="api/ballet.eng.base.html#ballet.eng.base.ConditionalTransformer" title="ballet.eng.base.ConditionalTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.base.ConditionalTransformer</span></code></a>.</p>
</div>
</div>
<div class="section" id="rolling-your-own-transformers">
<h2>Rolling your own transformers<a class="headerlink" href="#rolling-your-own-transformers" title="Permalink to this headline">¶</a></h2>
<p>As you come up with more creative features, you may find that you need to create your own
transformer classes. Here are some tips for creating your own transformers.</p>
<ol class="arabic simple">
<li><p>Build off of <a class="reference internal" href="api/ballet.eng.base.html#ballet.eng.base.BaseTransformer" title="ballet.eng.base.BaseTransformer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.base.BaseTransformer</span></code></a> which inherits from
<code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.base.BaseEstimator</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.base.TransformerMixin</span></code>, and
<a class="reference internal" href="api/ballet.eng.base.html#ballet.eng.base.NoFitMixin" title="ballet.eng.base.NoFitMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.eng.base.NoFitMixin</span></code></a>.</p></li>
<li><p>Read the <a class="reference external" href="https://scikit-learn.org/stable/developers/develop.html#rolling-your-own-estimator">scikit-learn documentation on a similar topic</a>.
(Note that this documentation page is likely overkill for the types of transformers you may be
implemeting.</p></li>
</ol>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Let’s create a feature that captures whether a string variable is the longest value observed in the
data. This is a silly feature for a number of reasons, so don’t take it too seriously, but it
demonstrates the steps required to roll your own transformer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ballet</span> <span class="kn">import</span> <span class="n">Feature</span>
<span class="kn">from</span> <span class="nn">ballet.eng.base</span> <span class="kn">import</span> <span class="n">BaseTransformer</span>

<span class="nb">input</span> <span class="o">=</span> <span class="s1">&#39;Exterior 1st&#39;</span>

<span class="k">class</span> <span class="nc">LongestStringValue</span><span class="p">(</span><span class="n">BaseTransformer</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">longest_string_length_</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">X</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longest_string_length_</span>

 <span class="n">transformer</span> <span class="o">=</span> <span class="n">LongestStringValue</span><span class="p">()</span>
 <span class="n">feature</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">transformer</span><span class="o">=</span><span class="n">transformer</span><span class="p">)</span>
</pre></div>
</div>
<p>Okay, let’s unpack what happened here. First, we declared the input to this feature, <code class="docutils literal notranslate"><span class="pre">'Exterior</span>
<span class="pre">1st'</span></code>, a scalar key, so the feature will receive a pandas <code class="docutils literal notranslate"><span class="pre">Series</span></code> as the input <code class="docutils literal notranslate"><span class="pre">X</span></code>. Next we
created a new class that inherits from <code class="docutils literal notranslate"><span class="pre">BaseTransformer</span></code>. The transformer does not have any
“hyperparameters” so we can skip defining an <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method. Following the scikit-learn
conventions, any learning from training data is done in the fit stage, and any learned parameters
are set on the class instance with names suffixed by a single underscore. The fit method should
also return <code class="docutils literal notranslate"><span class="pre">self</span></code> so that the <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code> method defined on <code class="docutils literal notranslate"><span class="pre">BaseTransformer</span></code> can work.
We were able to assume that <code class="docutils literal notranslate"><span class="pre">X</span></code> is a series, and thus has the <code class="docutils literal notranslate"><span class="pre">.str</span></code> vectorized string
accessor. (If this were to be a new feature engineering primitive that would be used in more than
this one situation, we might want to add logic to allow the feature to operate on a DataFrame as
well.) Next, in the transform stage, we check for each new instance whether the length is greater
than or equal to the longest string length observed in the training data. The result will be a 1-d
arrray (series) of bools. Finally, having created the transformer class, we create an instance of
it and create our Feature object.</p>
</div>
</div>
<div class="section" id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="api/ballet.feature.html#ballet.feature.Feature" title="ballet.feature.Feature"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.feature.Feature</span></code></a></p></li>
<li><p><a class="reference internal" href="api/ballet.pipeline.html#ballet.pipeline.FeatureEngineeringPipeline" title="ballet.pipeline.FeatureEngineeringPipeline"><code class="xref py py-class docutils literal notranslate"><span class="pre">ballet.pipeline.FeatureEngineeringPipeline</span></code></a></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api/ballet.html" class="btn btn-neutral float-right" title="ballet package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="contributor_guide.html" class="btn btn-neutral float-left" title="Contributor Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018, Micah Smith

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>